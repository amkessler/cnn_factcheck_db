---
title: "Facts First Database"
resource_files:
- .httr-oauth
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
---

```{r setup, include=FALSE}

library(flexdashboard)
library(tidyverse)
library(lubridate)
library(janitor)
library(glue)
library(plotly)
library(DT)
library(googlesheets)
library(kableExtra)
library(leaflet)
# library(ggmap)
library(RColorBrewer)
library(htmlwidgets)
library(htmltools)
library(tigris)
options(tigris_class = "sf")

#use saved version of data (for now during development)
fcheck <- readRDS("saved_versions/fcheck_0711.rds")

fcheck <- fcheck %>% 
  filter(source == "CNN")


# set time object set to EST
d <- Sys.Date()
# d <- .POSIXct(d, "EST")
  
t <- Sys.time()
t <- .POSIXct(t, "EST")

```


Table and Summary Charts
===================================== 
CNN Fact Checks through `r format(d, format="%b %d")`. To filter, click on the boxes above the columns. To sort, use the up/down arrows by the column names. To search globally by keywords, use the search box on the upper right. (Last updated on `r format(t, format="%B %d %I:%M %p %Z")`) 
<!-- (This dashboard was last updated at `r format(Sys.time(), "%a %b %d %X")`)  -->

Row {data-height=650}
-----------------------------------------------------------------------

### {data-width=800}

```{r}

#searchable table

datatable(fcheck, 
          rownames = FALSE, 
          filter = "top",
          options = list(searchHighlight = TRUE)) %>% 
  formatDate('date', 'toDateString') %>%  
  # formatDate('thru_date', 'toDateString') %>%
  formatStyle('candidate', fontWeight = 'bold') 





```



### Totals by truth spectrum

```{r}

byspectrum <- fcheck %>% 
  count(spectrum_of_truth) 


d <- ggplot(data = byspectrum, aes(x = spectrum_of_truth, y = n)) +
  geom_col(
    # color = "#848484",
    fill = "#FFC966") +
  # coord_flip() +
  theme_minimal()

d2 <- d + labs(x ="", y = "") +
  theme(plot.title = element_text(hjust = 0.5)) +
  # scale_fill_manual(values=cbPalette) +
  theme(legend.title=element_blank()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

dd <- ggplotly(d2)

dd_nomenu <- dd %>% config(displayModeBar = FALSE)
dd_nomenu


```


### Candidates with most fact checks

```{r}

bycand <- fcheck %>% 
  count(candidate) %>% 
  arrange(desc(n)) %>% 
  head() %>% 
  ungroup()


d <- ggplot(data = bycand, aes(x = bycand, y = n)) +
  geom_col(
    # color = "#848484",
    fill = "#FFC966") +
  # coord_flip() +
  theme_minimal()

d2 <- d + labs(x ="", y = "") +
  theme(plot.title = element_text(hjust = 0.5)) +
  # scale_fill_manual(values=cbPalette) +
  theme(legend.title=element_blank()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

dd <- ggplotly(d2)

dd_nomenu <- dd %>% config(displayModeBar = FALSE)
dd_nomenu


```





Upcoming Events Breakdown
=====================================


Row {data-height=300}
-----------------------------------------------------------------------





Questions?
=====================================

Row 
-----------------------------------------------------------------------
If you have any questions about this candidate tracker, please give a shout to Aaron Kessler in the DC bureau at Aaron.Kessler@turner.com. Thanks!
