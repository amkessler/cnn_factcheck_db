---
title: "Facts First Transitional App"
resource_files:
- .httr-oauth
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    theme: cerulean
---

```{r setup, include=FALSE}

library(flexdashboard)
library(tidyverse)
library(lubridate)
library(janitor)
library(glue)
library(plotly)
library(DT)
library(googlesheets)
library(kableExtra)
library(leaflet)
# library(ggmap)
library(RColorBrewer)
library(htmlwidgets)
library(htmltools)
library(tigris)
options(tigris_class = "sf")

#use saved version of data (for now during development)
fcheck <- readRDS("saved_versions/fcheck_saved.rds")

fcheck <- fcheck %>% 
  filter(source == "CNN")

fcheck <- fcheck %>% 
  mutate(
    candidate = as.factor(candidate),
    spectrum_of_truth = as.factor(spectrum_of_truth),
    subject = as.factor(subject)
  )


# set time object set to EST
d <- Sys.Date()
# d <- .POSIXct(d, "EST")
  
t <- Sys.time()
t <- .POSIXct(t, "EST")

```


Searchable Database
===================================== 
Published fact checks through `r format(d, format="%b %d")`. To filter, click on the boxes above the columns. To sort, use the up/down arrows by the column names. To search globally by keywords, use the search box on the right. (Last updated on `r format(t, format="%B %d %I:%M %p %Z")`) 
<!-- (This dashboard was last updated at `r format(Sys.time(), "%a %b %d %X")`)  -->

Row 
-----------------------------------------------------------------------

### {data-width=800}

```{r}

#searchable table

fcheck_table <- fcheck %>% 
  select(candidate,
         date,
         spectrum_of_truth,
         subject,
         claim,
         fact_check,
         link)

datatable(fcheck_table, 
          rownames = FALSE, 
          filter = "top",
          options = list(searchHighlight = TRUE)) %>% 
  formatDate('date', 'toDateString') %>%  
  # formatDate('thru_date', 'toDateString') %>%
  formatStyle('candidate', fontWeight = 'bold') 


```


Summary Counts
=====================================

Row 
-----------------------------------------------------------------------


### Totals by truth spectrum

```{r}

byspectrum <- fcheck %>% 
  count(spectrum_of_truth) 


d <- ggplot(data = byspectrum, aes(x = spectrum_of_truth, y = n)) +
  geom_col(
    # color = "#848484",
    fill = "#FFC966") +
  # coord_flip() +
  theme_minimal()

d2 <- d + labs(x ="", y = "") +
  theme(plot.title = element_text(hjust = 0.5)) +
  # scale_fill_manual(values=cbPalette) +
  theme(legend.title=element_blank()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

dd <- ggplotly(d2)

dd_nomenu <- dd %>% config(displayModeBar = FALSE)
dd_nomenu


```


### Candidates with most fact checks

```{r}

bycand <- fcheck %>% 
  count(candidate) %>% 
  arrange(desc(n)) %>% 
  head() %>% 
  ungroup()


e <- ggplot(data = bycand, aes(x = candidate, y = n)) +
  geom_col(
    # color = "#848484",
    fill = "#FFC966") +
  # coord_flip() +
  theme_minimal()

e2 <- e + labs(x ="", y = "") +
  theme(plot.title = element_text(hjust = 0.5)) +
  # scale_fill_manual(values=cbPalette) +
  theme(legend.title=element_blank()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ee <- ggplotly(e2)

ee_nomenu <- ee %>% config(displayModeBar = FALSE)
ee_nomenu


```


Row 
-----------------------------------------------------------------------

### Most common subjects

```{r}

bysubject <- fcheck %>% 
  count(subject) %>% 
  arrange(desc(n)) %>% 
  head() %>% 
  ungroup()


e <- ggplot(data = bysubject, aes(x = subject, y = n)) +
  geom_col(
    # color = "#848484",
    fill = "#FFC966") +
  # coord_flip() +
  theme_minimal()

e2 <- e + labs(x ="", y = "") +
  theme(plot.title = element_text(hjust = 0.5)) +
  # scale_fill_manual(values=cbPalette) +
  theme(legend.title=element_blank()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ee <- ggplotly(e2)

ee_nomenu <- ee %>% config(displayModeBar = FALSE)
ee_nomenu


```


### Most common TBD

Another chart to go here.




Questions?
=====================================

Row 
-----------------------------------------------------------------------
If you have any questions about these fact check records, please give a shout to Aaron.Kessler@cnn.com, Matthew.Philips@cnn.com or Cat.Gloria@cnn.com. 
